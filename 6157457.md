## 对Git的学习总结

之前在工作学习中总是会搜索到Github中的许多开源项目，下载后又不知道如何下手使用，对于Git、Github这些概念在学习了[廖雪峰的官方网站Git教程](https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000)后总算是有些眉目了。整个课程通俗易懂，偶有交代不清的地方稍作思考结合每篇教程的评论便能搞清楚，对于学习Git分布式版本管理入门来说是很好的教材。通读全部教程，并结合一些博客说明，我尝试写了一篇学习总结，检验一下自己的学习效果。需要注意，本文主要是加深对Git的理解，初学者通过本文可以初窥Git的一些基本概念，并不适合直接用来作为教程从零学习Git。

Git是一种分布式版本管理系统，能够对文本文件的改动进行跟踪管理。文件的每一次改动都会被记录，然而这个记录方式不是积累不同版本的文件，而是针对修改动作的记录，所以不会大幅增加存储负担。你可以在需要时候找到一个文件或一整个项目在之前历次修改提交时候的内容。

分布式管理的一个优点是可以拷贝远程版本库Repository的完整版本信息到本地，然后在断网的情况下正常的进行文件添加修改提交等版本更新操作，然后在有了网络后将本地更新推送到远程版本库。即便远程版本库丢失，也不会有较大损失。区别于集中式版本管理系统，例如SVN，有一个中央服务器负责版本管理，所有版本更新操作必须在联网情况下和中央服务器通信才能完成。对于创建分支版本等功能在使用中也不够方便。所以Git这种分布式版本管理系统变的越来越流行。（关于分布式版本管理系统和集中式版本管理系统的优缺点对比并不是本文的写作重点。）

为了便于多人协作，我们需要将一个项目的标准版本放在开发者都能看到能获取到的地方，所以有了[GitHub](https://github.com/)这个代码托管网站，相当于一个远程的存储仓库。（国内可以使用Gitee[码云](https://gitee.com/)这个提供相似功能的网站。）

### Git的工作流程

![image](http://img.blog.csdn.net/20160430221106224)

项目管理人员或主开发者首先初始化一个仓库，这个仓库可以创建在本地电脑上，也可以创建在远程Git服务器（GitHub）中。然后在仓库中添加初始版本的项目源码，如果操作在远程服务器中完成，那么通过clone命令将远程仓库拷贝到本地，同理如果操作在本地完成，那么可以通过push命令将本地仓库推送到远程服务器，这样本地仓库和远程仓库就有了相同的内容。在以后的开发中，开发者就在本地仓库进行版本更新，然后将最后检验确认的版本推送到远程仓库。
- **远程仓库** 
——管理项目版本升级信息和项目最终源码的地方。远程仓库的主要目的在于存储一份标准版本的项目文件便于项目管理和更新。所有的项目成员根据这个标准版本来更新升级项目，然后大家分别将各自更新后的成果合并到这个远程仓库的标准版本中。
- **本地仓库**
——开发者拷贝远程仓库到本地后管理项目的地方。初始时和远程仓库是一模一样的，然后开发者在此基础上更新升级项目，在本地进行各种项目版本管理操作。
- **暂存区**
——用来存放即将放入本地仓库的文件改动信息的缓冲区。如果有许多文件改动需要被放入本地仓库进行版本管理，可以先放入这个暂存区，然后统一提交到本地仓库，方便版本管理。
- **工作区**
——用来存放项目源码文件的目录。开发者利用此目录中的源码完成项目功能的更新，然后添加到暂存区，最后提交修改到本地仓库，记录版本修改信息。

### Git的使用方法

Git可以在Linux、Mac OS、Windows等平台使用，具体安装方法请参考[廖雪峰的官方网站](https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137396287703354d8c6c01c904c7d9ff056ae23da865a000)。下面以命令行方式简介Git使用的一些基本命令。

#### 配置Git用户名密码
为了表明是谁向版本库提交了修改，首先要配置一下Git的用户名和email地址。
```
git config --global user.name "your name" #配置你的名字
git config --global user.email "email@example.com" #配置你的邮箱
git config -l #查看配置信息
```
--global 参数表明当前机器中所有的本地仓库都使用这个用户名和邮箱作为开发者的身份标识，但是你是可以让不同的本地仓库使用不同配置信息的。比如你公司的Git服务器使用的是和Github上不同的一个用户名邮箱，那么你需要在公司项目工作区的根目录单独配置用户名邮箱如下：
```
git config user.name "your name2" #配置公司项目的名字
git config user.email "email2@example.com" #配置公司项目的邮箱
git config -l #查看配置信息
```
这样就会优先使用当前的用户信息配置，而不是全局配置中的用户名邮箱。

#### 初始化一个版本库 
```
git init 
#初始化一个空的仓库，可以发现当前工作区中出现了一个.git的文件夹，
#这个就是我们生成的版本库，它将此工作区目录变成了Git可以管理的仓库
#即便这个工作区原来有文件，但是这些文件都还没有提交过，所以，当前仓库任然是空的。

git add readme.md #向暂存区添加一个介绍本项目的文件。

git commit -m "添加readme.md" #将当前暂存区中的文件都提交到仓库，每次写好注释便于以后查看
```
如果一个功能更新涉及多个文件改动，可以添加多个文件到暂存区，
然后一次性commit提交到仓库。一次commit，就在仓库中增加
了一个版本，类似一个快照，以后不管你更新了多少个版本，都可
以返回当前版本（快照）。
```
git status #查看当前仓库状态信息。此命令可以告诉你当前工作区中相对于当前版本的仓库中哪些文件是没有提交过的新文件，哪些是修改过的，哪些是删除的。

git diff filename.txt #查看当前filename文件和仓库当前版本记录中的filename文件的差异。如果已经将当前filename文件添加到暂存区，那么此命令就无法显示差异了。
```

以上就是让仓库记录一个版本修改常用的一些命令。那么如果你已经提交了多次修改，在仓库中就会记录多个版本，怎么回退到你之前的版本呢？
```
git log #查看版本提交记录，从近到远显示历次提交的修改。每个版本ID号是一串很长的数字，通常采用前7位就可以代表此版本号。

git reset --hard 1234567 #将工作区内容回退到1234567所在版本。
```
在Git管理中，仓库中当前版本用head表示，上一个版本用head^ 表示，前两个版本head^^ 表示，前100个版本head~100 表示。当然这样表示开发者很难知道前100个版本到底有什么改动，所以使用版本ID是比较常用的方式。

**注意**：使用--hard参数进行版本回退后，当前工作区中未提交到暂存区或仓库中的文件修改都将被丢弃，暂存区中的修改会清空，此时的工作区内容将变成版本1234567时候的状态，所以使用时候需要小心。也就是说我们工作区的文件会因为版本切换而改变成对应版本的文件，大家会发现版本切换后，文件数量增减或内容变化的情况，都是Git版本管理搞的鬼。
```
#当你使用 git reset 回到过去(之前的版本)后，再使用 git log 命令版本ID记忆就停留在了过去，必须使用
git reflog #恢复未来的记忆，找到想去的未来的版本ID，回到未来。
```

git reset命令后面还可以跟很多其他参数，具体使用情形参考[此链接](http://blog.csdn.net/hudashi/article/details/7664464/)。

介绍了以上常用命令，基本上对本地仓库版本管理有了基本了解，现在你可能对工作区、暂存区（又叫stage或者index）和版本库等概念有些混淆，那么可以参考下图：
![image](http://img.blog.csdn.net/20151030110206984?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)


[此博客链接](http://www.cnblogs.com/lianghe01/p/5846525.html#3806554)对此图有相关实例介绍。

#### 创建合并分支
每个仓库创建后都有一个master主分支，但是如果你一直在主分支上提交修改，会发现主分支的版本非常凌乱，在实际项目开发中，为了保证主分支的简洁稳定，开发者常常会创建一个分支版本来更新项目，待功能稳定后，将分支版本和主分支合并。如果同一个项目要针对不同客户开发多个有差异的版本，那么也可以创建多个分支，在不同分支上开发相应的版本。所以分支对Git管理来说，相当重要。

```
git branch dev #创建develop分支
git checkout dev #切换到dev分支

git checkout -b dev #创建并切换dev分支

```
在master分支中创建dev分支，那么dev分支的初始版本就和master分支当前版本内容一致。你会发现，刚创建并切换分支后，工作区内容并没有变化，就是这个原因。一旦dev分支更新提交过，那么你再切换分支master，你会发现，工作区内容会变成master分支的内容。

dev分支在多次提交完成项目功能升级后，就需要和master主分支合并。

```
git checkout master #首先切换到主分支
git merge dev #将dev分支合并到当前分支
git branch -d dev #删除dev分支

git branch -a #查看当前仓库所有分支，包括远程仓库的分支
```
但是分支合并时，并不是一直一帆风顺的，如果两个分支都各自有更新，那么在合并时就可能产生冲突，合并无法正常完成，需要先解决冲突，修改冲突文件，然后再次提交修改，才算合并完成。
```
git log --graph --pretty=oneline --abbrev-commit #查看分支合并情况
```
如果想保留分支的提交记录，那么在分支合并时需要加上特定参数
```
git merge --no-ff -m "注释" dev #合并dev分支到主分支时，保留dev分支的版本提交记录
```
采用不同参数合并分支后可以通过下图查看合并结果。
![image](https://note.youdao.com/yws/api/personal/file/F2B94370E87B4097BE7CAC5A8AAB601F?method=download&shareKey=80f703d873cc40db4df1bc609cecb874)

分支在项目开发中使用特别常见，比如添加新功能可以创建一个分支，修改一个Bug也要创建一个分支，由于Git创建分支特别简单，所以尽可能使用分支对于主分支的稳定和简洁很有必要。

**注意**：分支合并有两种不同的命令
```
git merge #分支合并
git rebase #分支衍合
```
什么情况下采用merge方式，什么情况下采用rebase方式可以参看[此链接](https://www.cnblogs.com/kidsitcn/p/5339382.html)。

### Git在实际项目开发中的使用

上文介绍了Git在本地仓库管理使用的一些基本指令。然而实际项目开发是多人合作完成的，主干代码库的稳定需要一个大家都能访问的远程仓库管理。
在连接远程仓库时为了避免每次输入用户名密码的麻烦，开发者可以提前配置好SSH密钥对加密传输数据。

#### 配置SSH密钥对
如果要将本地仓库安全便捷的推送到远程服务器，Git采用SSH协议对和远程服务器通信的信息进行确认，所以你需要生产一个SSH密钥对，将公钥保存在服务器，这样每次和远程服务器通信就不用输入密码确认了。
```
ssh-keygen -t rsa -C "youremail@example.com" #创建密钥对 -t参数 密钥类型，-C参数 注释
```
产生密钥对后，开发者将公钥数据交给项目管理人员，将公钥保存在远程Git服务器，配置就完成了。第一次连接Git远程服务器SSH会提示警告要你比对Key的指纹信息正确性，yes确认就好。

#### 实际项目开发
由于我没有在公司项目开发中使用过Git版本管理，所以根据教程学习结合一些博客的介绍，总结出实际项目开发的大致流程如下，如有错误之处，请指正说明，非常感谢。

1、主开发者或项目管理人员生成一个本地仓库，提交初始版本项目源码，然后推送到远程服务器上。这时远程服务器就有了一个远程仓库，里面有初始版本的项目源码。

2、为了保证主分支代码简介稳定，创建一个develop分支，推送到远程仓库。

3、所有开发者从远程仓库的develop分支克隆项目。各自有一个本地仓库。根据各自的任务在本地仓库提交项目更新，然后去和远程仓库develop分支合并。同理开发者在本地仓库也应该创建一个本地的develop分支，便于维护本地主分支。

简单的项目开发图解类似下图所示：
![images](https://cdn.webxueyuan.com/cdn/files/attachments/001384909239390d355eb07d9d64305b6322aaf4edac1e3000/0)

master是远程主分支，dev是开发分支，michael和bob各自拷贝开发分支到本地，然后在本地仓库更新项目，然后各自合并到开发分支中。开发分支中出现稳定版本后，就将开发分支合并到主分支。

更为细致的大型项目开发图解可以参考下图：
![images](https://segmentfault.com/img/remote/1460000006724851)

关于在项目中采用Git进行版本管理更为详细的介绍可以参考[此博客链接](https://segmentfault.com/a/1190000006724816)。


